---
import {getRelativeLocaleUrl} from 'astro:i18n';
import {currentLanguage, useTranslations, useLocalePages} from '../i18n/utils';
import {Icon} from 'astro-icon/components';
import Search from 'astro-pagefind/components/Search';

import Logo from '../images/GeoEngine_Mainlogo_Line_Schutzraum_4c_weiss.svg';

const logoHeightPx = 74;
const logoWidthPx = logoHeightPx * (1920 / 498);

const currentLang = currentLanguage(Astro.currentLocale);

const t = useTranslations(Astro.currentLocale);
const p = useLocalePages(Astro.currentLocale);
---

<style>
    .pagefind-ui :global(.pagefind-ui__drawer:not(.pagefind-ui__hidden)) {
        max-height: 33vh;
        background-color: var(--color-white);
        overflow-y: auto;
    }
</style>

<header class="sticky top-0 z-50 flex w-full flex-wrap bg-black md:flex-nowrap md:justify-start">
    <nav class="relative mx-auto w-full max-w-5xl px-4 py-2 sm:px-6 md:flex md:items-center md:justify-between md:gap-3 lg:px-8">
        <!-- Logo w/ Collapse Button -->
        <div class="flex items-center justify-between">
            <a
                class="flex-none text-xl font-semibold text-white focus:opacity-80 focus:outline-hidden"
                href={getRelativeLocaleUrl(currentLang, '/')}
                aria-label="Geo Engine"
            >
                <Logo height={logoHeightPx} width={logoWidthPx} />
            </a>

            <!-- Collapse Button -->
            <div class="md:hidden">
                <button
                    type="button"
                    class="hs-collapse-toggle relative flex size-9 cursor-pointer items-center justify-center rounded-lg border border-white/50 text-sm font-semibold text-white hover:bg-white/10 focus:bg-white/10 focus:outline-hidden disabled:pointer-events-none disabled:opacity-50"
                    id="hs-base-header-collapse"
                    aria-expanded="false"
                    aria-controls="hs-base-header"
                    aria-label="Toggle navigation"
                    data-hs-collapse="#hs-base-header"
                >
                    <svg
                        class="hs-collapse-open:hidden size-4"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        ><line x1="3" x2="21" y1="6" y2="6"></line><line x1="3" x2="21" y1="12" y2="12"></line><line
                            x1="3"
                            x2="21"
                            y1="18"
                            y2="18"></line></svg
                    >
                    <svg
                        class="hs-collapse-open:block hidden size-4 shrink-0"
                        xmlns="http://www.w3.org/2000/svg"
                        width="24"
                        height="24"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg
                    >
                    <span class="sr-only">Toggle navigation</span>
                </button>
            </div>
            <!-- End Collapse Button -->
        </div>
        <!-- End Logo w/ Collapse Button -->

        <!-- Collapse -->
        <div
            id="hs-base-header"
            class="hs-collapse hidden grow basis-full overflow-hidden font-semibold transition-all duration-300 md:block"
            aria-labelledby="hs-base-header-collapse"
        >
            <div
                class="max-h-[75vh] overflow-hidden overflow-y-auto [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:bg-gray-300 dark:[&::-webkit-scrollbar-thumb]:bg-neutral-500 [&::-webkit-scrollbar-track]:bg-gray-100 dark:[&::-webkit-scrollbar-track]:bg-neutral-700"
            >
                <div class="flex flex-col gap-0.5 py-2 md:flex-row md:items-center md:justify-end md:gap-1 md:py-0">
                    <a
                        class="flex items-center p-2 text-sm text-white focus:text-white focus:outline-hidden"
                        href={p('services')}
                        aria-current="page"
                    >
                        <Icon name="mdi:service-toolbox" class="me-3 block size-4 shrink-0 md:me-2 md:hidden" />
                        {t('nav.services')}
                    </a>

                    <a
                        class="flex items-center p-2 text-sm text-white focus:text-white focus:outline-hidden"
                        href={p('data')}
                        aria-current="page"
                    >
                        <Icon name="mdi:database" class="me-3 block size-4 shrink-0 md:me-2 md:hidden" />
                        {t('data.title')}
                    </a>

                    <a
                        class="flex items-center p-2 text-sm text-white/80 hover:text-white focus:text-white focus:outline-hidden"
                        href={p('news')}
                    >
                        <Icon name="mdi:newspaper-variant-outline" class="me-3 block size-4 shrink-0 md:me-2 md:hidden" />
                        {t('news.nav')}
                    </a>

                    <a
                        class="flex items-center p-2 text-sm text-white/80 hover:text-white focus:text-white focus:outline-hidden"
                        href={p('references')}
                    >
                        <Icon name="mdi:file-document-box-multiple-outline" class="me-3 block size-4 shrink-0 md:me-2 md:hidden" />
                        {t('nav.references')}
                    </a>

                    <a
                        class="flex items-center p-2 text-sm text-white/80 hover:text-white focus:text-white focus:outline-hidden"
                        href={p('about')}
                    >
                        <Icon name="mdi:people-group" class="me-3 block size-4 shrink-0 md:me-2 md:hidden" />
                        {t('nav.about')}
                    </a>

                    <a
                        class="flex items-center p-2 text-sm text-white/80 hover:text-white focus:text-white focus:outline-hidden"
                        href={p('contact')}
                    >
                        <Icon name="mdi:contact-mail-outline" class="me-3 block size-4 shrink-0 md:me-2 md:hidden" />
                        {t('nav.contact')}
                    </a>

                    <!-- Button Group -->
                    <div
                        class="relative mt-1 flex flex-wrap items-center gap-x-1.5 before:absolute before:-start-px before:top-1/2 before:block before:h-4 before:w-px before:-translate-y-1/2 before:bg-white/30 md:ms-1.5 md:mt-0 md:ps-2.5"
                    >
                        <button
                            class="flex w-full cursor-pointer items-center p-2 text-sm text-white/80 hover:text-white focus:text-white focus:outline-hidden"
                            onclick="
                                const search = document.querySelector('.pagefind-ui');
                                if (search) {
                                    search.classList.toggle('hidden');
                                    search.focus();
                                } 
                                "
                        >
                            <Icon name="mdi:search" class="me-3 size-4 shrink-0 md:me-2" />
                            <span class="md:hidden">Search</span>
                        </button>
                    </div>
                    <!-- End Button Group -->
                </div>
            </div>
        </div>
        <!-- End Collapse -->
    </nav>
</header>

<aside class="pagefind-ui hidden">
    <Search id="search" className="fixed w-full" uiOptions={{showImages: false}} />
</aside>
